TODO
====

- Investigate the possibility of using an external CSS checker in order to enable a default "css" filter
- Create a way for special XSL to be evaluated at the start/end of a rendering in order to embed resources such as external scripts
- Create BBCodesConfig::getBBCodeTemplate() that returns the definition of a BBCode, e.g. [URL={URL}]{TEXT}[/URL]
- Look into properly implementing urlencode() and rawurlencode() in JS
- Read in #phpbb-dev: ""You cannot have 3 quotes within each other" I'm getting pretty annoyed by that one now >.<" "Has some kind of system that automatically removes the innermost quote been suggested? On large posts it's almost impossible to remove it by hand without messing the tags up :<" "Right now I just copy the text and paste it within [quote] because it's easier to see, but that kinda takes away the point with the quote button" -- could be implemented as a new setting: nestingLimitAction (similar to regexpLimitAction) with possible values "ignore" (leave as text), "strip" (remove content via <i> tag) and "abort" (throw exception?) -- Actually, this case is better handled at quoting time by removing the quotes from the original message directly, e.g. remove all //QUOTE//QUOTE//QUOTE nodes. Add a class that handles that kind of manipulation, e.g. removeNestedTags($tagName, $nestingLimit)
- Fix the path in "// Start of content generated by .." comments
- Sort the "isTransparent" situation wrt <video>. isTransparent makes a tag inherit the list of disallowed children from its parent, but it cannot currently allow tags that aren't allowed by its parent. In most cases, it doesn't matter, but it prevents using <track> as the child of <video> through the HTMLElements plugin
- Consider allowing absolute paths in #url, e.g. "/foo.html" - also, fragment "#foo"
- Consider a way to disallow HTML elements globally or at the tag-level. For example, a way to globally disable <a> so that BBCodes that produces links are disabled
- Read in phpBB's forum 'maybe you put a threshold on errors -- if there are more than, say, 10, put out an error saying "Too many BBCode formatting errors found; fix the above and Preview the post again."' -- https://area51.phpbb.com/phpBB/viewtopic.php?f=108&t=33021&p=249335#p249335 -- NOTE: kind of sucks when those errors come from false positive from things like Autolink
- Read and consider https://github.com/Seldaek/fig-standards/blob/logger-interface/proposed/logger-interface.md
- Add some sort of optional filtering/escaping to the variables used in repositories? htmlspecialchars(), json_encode()
- Add some sort of TemplateHelper::loadHTML() to load HTML templates. XSL elements should be dropped or converted to HTML elements, and curly brackets in attributes should be escaped
- Exploitable? http://sla.ckers.org/forum/read.php?2,36997
- There are many SVG vectors, too many to chase after individually. Prevent any user-supplied data in <svg> tags (in any namespace) or add isSafeInSVG() with a very restricted set of allowed filters -- http://html5sec.org/#94
- http://html5sec.org/#49 -- http://shazzer.co.uk/database/All/Characters-allowed-inside-jsurl http://html5sec.org/#36
- Test how conditional comments in templates are rendered
- Re-enable the optimization that uses <xsl:element name="{translate('ABC','abc',name())}"/>
- PHP renderer: consider caching $node->textContent for performance, especially wrt Emoticons
- Conditional comments can create IE-specific exploits. Consider removing them
- PHP renderer generator: optimize substring() in convertXPath()
- Consider adding Configurable::__set_state()
- HINT.RULE_* hints must check for the use of Tag.setFlags()
- Consider adding one callback opportunity before and after rendering. The callback would receive the XML (before) or HTML (after) and the Renderer instance
- Consider adding an option to abort parsing when tagLimit is exceeded (good for Censor)
- One cheap way to filter a CSS value would be to set an attribute preprocessor for every supported CSS attribute, e.g. /(?<!\w)color\s*:\s*(?<color>#[0-9a-f]+|\w+)/ - could be mentionned in cookbook
- Move JavaScript\RegExp functionality to Items\Regexp
- MediaEmbed: add an oEmbed helper
- JavaScript: check whether registeredVars's keys are preserved. convertCallback() should always use the bracket notation when accessing registeredVars, otherwise registerVar() would not work
- Some characters such as [ and ] should always be URL-encoded to pass W3C validation. Others are recommended to be escaped as per RFC 2396 2.4.3. XSLT systematically encode even more characters. Consider adding a TemplateNormalizer for encoding static values in URL attributes, and some mechanism in the PHP renderer generator to escape dynamic values. Consider adding a "url" flag in the representation generated by the TemplateParser. Could be called "context" and be extended to JS and CSS.
- Consider adding a way to apply RulesGenerators on a per-tag basis. For instance, it makes sense to have BlockElementsFosterFormattingElements on a CENTER tag, but not so much on QUOTE or CODE
- BuiltInFilters: don't encode brackets used in the host part, e.g. IPv6 address. Low priority, as ext/filter does not allow IPv6 addresses in URLs anyway -- https://bugs.php.net/bug.php?id=54629
- Create an exception used in security checks so that an implementor can log security exceptions differently from other exceptions
- Consider adding <q> (quick) as root element to indentify content that is not plain text but might be renderable via regexps
- Add hints to the PHP parser. Makes hints take the form of a bitfield, e.g. "if ($this->hints & self::HAS_ATTRIBUTE_GENERATORS)"
- Clean up illegal UTF-8 in parse()?
- Set DOMDocument::$recover in Renderer#loadXML()
- Force a paragraph break when a formatting element is open and two newlines are found?
- s9e\TextFormatter\Configurator\Helpers\RegexpBuilder::fromList(['*x', 'x'],['specialChars'=>['*'=>'[^z]+']]) should return '(?:[^z]+)?x' not '[^z]+?x'
- Consider adding a whitelist to Censor
