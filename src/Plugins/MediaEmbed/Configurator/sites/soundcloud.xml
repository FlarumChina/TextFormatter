<site name="SoundCloud" homepage="https://soundcloud.com/" unresponsive="1">
	<source>https://soundcloud.com/pages/widgets</source>
	<example>http://api.soundcloud.com/tracks/98282116</example>
	<example>https://soundcloud.com/andrewbird/three-white-horses</example>
	<example>https://soundcloud.com/tenaciousd/sets/rize-of-the-fenix/</example>

	<tags><tag>music</tag></tags>

	<host>soundcloud.com</host>
	<extract>@(?'id'https?://(?:(?:api\.soundcloud\.com/(?:playlist|track)s/\d+)|soundcloud\.com/[^/]+/(?:sets/)?[^/]+)(?:(?:\?secret_token=|/(?=s-))(?'secret_token'[-\w]+))?|^[^/]+/[^/]+$)@</extract>
	<scrape url="https://api.soundcloud.com/resolve?url={@id}&amp;_status_code_map%5B302%5D=200&amp;_status_format=json&amp;client_id=b45b1aa10f1ac2941910a7f0d10f8e28&amp;app_version=7a35847b">
		<!-- Match URLs with a secret token -->
		<match>@soundcloud\.com/(?!playlists/|tracks/)[^/]+/(?:sets/)?[^/]+/s-@</match>
		<extract>@playlists/(?'playlist_id'\d+)@</extract>
		<extract>@tracks/(?'track_id'\d+)@</extract>
	</scrape>
	<iframe width="100%" height="166" style="max-width:900px">
		<src><![CDATA[
			<xsl:text>https://w.soundcloud.com/player/?url=</xsl:text>
			<xsl:choose>
				<xsl:when test="@secret_token and @playlist_id">
					<xsl:text>https://api.soundcloud.com/playlists/</xsl:text>
					<xsl:value-of select="@playlist_id"/>
					<xsl:text>&amp;secret_token=</xsl:text>
					<xsl:value-of select="@secret_token"/>
				</xsl:when>
				<xsl:when test="@secret_token and @track_id">
					<xsl:text>https://api.soundcloud.com/tracks/</xsl:text>
					<xsl:value-of select="@track_id"/>
					<xsl:text>&amp;secret_token=</xsl:text>
					<xsl:value-of select="@secret_token"/>
				</xsl:when>
				<xsl:otherwise>
					<xsl:if test="not(contains(@id, '://'))">
						<xsl:text>https://soundcloud.com/</xsl:text>
					</xsl:if>
					<xsl:value-of select="@id"/>
					<xsl:if test="@secret_token">
						<xsl:text>&amp;secret_token=</xsl:text>
						<xsl:value-of select="@secret_token"/>
					</xsl:if>
				</xsl:otherwise>
			</xsl:choose>
		]]></src>
	</iframe>
</site>