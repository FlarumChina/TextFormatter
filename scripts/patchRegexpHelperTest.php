#!/usr/bin/php
<?php

namespace s9e\TextFormatter\Tests;

class Test {}

function _array(array $arr)
{
	$i = -1;

	$php = 'array(';
	foreach ($arr as $k => $v)
	{
		if (++$i)
		{
			$php .= ', ';
		}

		if (!is_numeric($k))
		{
			$php .= var_export($k, true) . ' => ';
		}

		$php .= (is_array($v)) ? _array($v) : var_export($v, true);
	}

	$php .= ')';

	return $php;
}


include __DIR__ . '/../tests/ConfigBuilder/Helpers/RegexpHelperTest.php';

$test = new ConfigBuilder\Helpers\RegexpHelperTest;

$php = '';
foreach ($test->getWordsLists() as $case)
{
	$regexp   = var_export($case[0], true);
	$wordlist = _array($case[1]);

	$php .= "\n\t/**\n\t* @testdox buildRegexpFromList([" . substr($wordlist, 6, -1) . "]";

	if (isset($case[2]))
	{
		$options = strtr(json_encode($case[2]), array(
			'{' => '[',
			'}' => ']',
			',' => ', ',
			':' => ' => '
		));

		$php .= ', ' . $options . '';
	}

	$php .= ") returns " . $regexp . "\n\t*/\n\tpublic function test_buildRegexpFromList_" . strtoupper(dechex(crc32(serialize($case)))) . "()\n\t{\n\t\t\$this->assertSame(\n\t\t\t" . $regexp . ",\n\t\t\tRegexpHelper::buildRegexpFromList(";

	if (isset($case[2]))
	{
		$php .= "\n\t\t\t\t" . $wordlist . ",\n\t\t\t\t" . _array($case[2]) . "\n\t\t\t";
	}
	else
	{
		$php .= $wordlist;
	}

	$php .= ")\n\t\t);\n\t}\n";
}

$filepath = __DIR__ . '/../tests/ConfigBuilder/Helpers/RegexpHelperTest.php';
$file = file_get_contents($filepath);

$startComment = '// Start of content generated by ../../../scripts/patchRegexpHelperTest.php';
$endComment = "\t// End of content generated by ../../../scripts/patchRegexpHelperTest.php";

$file = substr($file, 0, strpos($file, $startComment) + strlen($startComment))
      . $php
      . substr($file, strpos($file, $endComment));

file_put_contents($filepath, $file);

die("Done.\n");